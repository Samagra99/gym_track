<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Workout Tracker (Cloud Sync)</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

<script>
// ⭐⭐ IMPORTANT ⭐⭐
// PASTE YOUR FIREBASE CONFIG HERE
// Replace the placeholder below:

 const firebaseConfig = {
    apiKey: "AIzaSyBeh-4g57-HcZc3pvmvPkAa0v_0giuA5yw",
    authDomain: "gym-track-79e54.firebaseapp.com",
    projectId: "gym-track-79e54",
    storageBucket: "gym-track-79e54.firebasestorage.app",
    messagingSenderId: "281510804516",
    appId: "1:281510804516:web:78e3898f74d840b78c6cb1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
</script>

<style>
  /* --- SAME EXACT STYLES FROM YOUR PREVIOUS VERSION --- */
  /* (I kept everything identical for continuity) */

  :root{
    --bg:#f7f8fb; --card:#ffffff; --accent:#2563eb; --muted:#6b7280; --ok:#10b981;
    --danger:#ef4444; --glass: rgba(0,0,0,0.04);
  }
  *{box-sizing:border-box}
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg); margin:0; color:#111; padding:20px; -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:980px;margin:0 auto;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  button, .pill{cursor:pointer;border:0;background:var(--card);padding:8px 12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.06)}
  .nav-btn{background:transparent;border:1px solid var(--glass);padding:8px 10px}
  .date-display{font-weight:600;padding:8px 12px;border-radius:8px;background:linear-gradient(180deg,#fff, #fbfdff);box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  main{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,0.04)}
  .session{margin-bottom:12px;padding:10px;border-radius:10px;border:1px solid var(--glass)}
  .session h3{margin:0 0 6px 0;font-size:16px}
  .exercise-list{margin:0;padding:0;list-style:none}
  .exercise-list li{padding:8px 6px;border-top:1px dashed rgba(0,0,0,0.04);display:flex;align-items:center;gap:10px}
  .exercise-list li:first-child{border-top:0}
  .session-actions{display:flex;gap:8px;align-items:center;margin-top:8px}
  .large-btn{padding:10px 14px;border-radius:10px;font-weight:600}
  .complete{background:linear-gradient(90deg,var(--ok),#0ea5a4);color:white}
  .incomplete{background:linear-gradient(90deg,#fff,#fff0);color:var(--muted);border:1px dashed var(--glass)}
  .progress {height:12px;background:linear-gradient(90deg,#e6eefc,#f3f7ff);border-radius:999px;overflow:hidden;border:1px solid var(--glass)}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7dd3fc);width:0%;}
  .small{font-size:13px;color:var(--muted)}
  aside .card{position:sticky;top:18px}
  .month-grid{display:flex;gap:6px;align-items:flex-end;height:140px;padding:12px 6px;overflow-x:auto}
  .day-col{flex:0 0 22px;text-align:center}
  .bar{height:0%;width:100%;border-radius:6px;background:linear-gradient(180deg,var(--accent),#60a5fa)}
  .day-label{font-size:10px;color:var(--muted);margin-top:6px;white-space:nowrap}
  .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
  .muted{color:var(--muted)}
  .actions .pill{display:inline-flex;align-items:center;gap:8px}
  .danger{background:var(--danger);color:#fff}
  .export-area{width:100%;height:120px;padding:8px;border-radius:8px;border:1px dashed var(--glass);background:#fafafa;resize:vertical;overflow:auto;font-family:monospace;font-size:12px}
  label.checkbox{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
  input[type="checkbox"]{width:18px;height:18px}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

  /* LOGIN SCREEN */
  #loginScreen{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:var(--bg);
    display:flex;justify-content:center;align-items:center;
    flex-direction:column;gap:20px;
    z-index:9999;
  }
  #loginScreen button{
    padding:12px 20px;font-size:16px;border-radius:8px;
    background:var(--accent);color:white;border:0;
  }
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h2>Sign in to sync your workout data</h2>
  <button id="googleLoginBtn">Sign in with Google</button>
</div>
<div class="wrap" id="appUI" style="display:none;">
  <header>
    <div>
      <h1>Workout Tracker — Cloud Synced</h1>
      <div class="small muted">Your progress automatically syncs to Firestore.</div>
    </div>

    <div class="controls">
      <div class="nav">
        <button class="nav-btn" id="prevBtn">&larr;</button>
        <button class="nav-btn" id="todayBtn">Today</button>
        <button class="nav-btn" id="nextBtn">&rarr;</button>
      </div>
      <div class="date-display" id="dateDisplay">—</div>
    </div>
  </header>

  <main>
    <section>
      <div class="card" id="dayCard">
        <h2 id="dayTitle">Day</h2>

        <div class="session">
          <h3>Morning Session</h3>
          <ul class="exercise-list" id="morningList"></ul>
          <div class="session-actions">
            <button id="toggleMorning" class="large-btn incomplete">Mark Morning Complete</button>
            <div class="small muted" id="morningStatus"></div>
          </div>
        </div>

        <div class="session">
          <h3>Evening Session</h3>
          <ul class="exercise-list" id="eveningList"></ul>
          <div class="session-actions">
            <button id="toggleEvening" class="large-btn incomplete">Mark Evening Complete</button>
            <div class="small muted" id="eveningStatus"></div>
          </div>
        </div>

        <div>
          <div class="small muted">Daily Progress</div>
          <div class="progress"><i id="dailyProgressBar"></i></div>
          <div class="meta">
            <strong id="dailyPercent">0%</strong>
            <div class="small muted" id="daySummary"></div>
          </div>

          <div class="action-row" style="margin-top:10px;">
            <button id="resetDay" class="pill">Reset Day</button>
            <button id="exportBtn" class="pill">Export JSON</button>
            <button id="importBtn" class="pill">Import JSON</button>
            <button id="clearAll" class="pill danger">Clear ALL Cloud Data</button>
          </div>
        </div>
      </div>
    </section>

    <aside>
      <div class="card">
        <h3>30-Day Progress</h3>
        <div class="small muted">Click a bar to open that day.</div>
        <div class="month-grid" id="monthGrid"></div>

        <div style="margin-top:12px">
          <div class="small muted">Overall</div>
          <div class="progress"><i id="overallBar"></i></div>
          <div class="meta">
            <strong id="overallPercent">0%</strong>
            <div class="small muted" id="overallSummary"></div>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="small muted">Export / Import</div>
          <textarea id="exportArea" class="export-area"></textarea>
        </div>
      </div>
    </aside>
  </main>

  <footer>
    Your data is safe in Firestore. Works offline too.
  </footer>
</div>
<script>
// -------------------------
// 1. GOOGLE LOGIN HANDLING
// -------------------------
const loginScreen = document.getElementById("loginScreen");
const appUI = document.getElementById("appUI");
document.getElementById("googleLoginBtn").addEventListener("click", async () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  try {
    // Try popup (works on some mobile browsers)
    await firebase.auth().signInWithPopup(provider);
  } catch (err) {
    console.warn("Popup sign-in failed or blocked, falling back to redirect:", err && err.code);
    try {
      // Redirect is generally more reliable on mobile
      await firebase.auth().signInWithRedirect(provider);
    } catch (err2) {
      console.error("Redirect sign-in failed:", err2);
      alert("Sign-in failed — check console for details.");
    }
  }
});


auth.onAuthStateChanged(user => {
  if (user) {
    loginScreen.style.display = "none";
    appUI.style.display = "block";
    userId = user.uid;
    loadFromFirestore();
  }
});

// -------------------------
// 2. FIRESTORE SYNC LOGIC
// -------------------------
let userId = null;
let data = {}; // Cloud copy
let localBackup = {}; // Offline copy
const STORAGE_KEY = "workout_local_backup";

function saveLocal() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(localBackup));
}
function loadLocal() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (raw) localBackup = JSON.parse(raw);
}

loadLocal();

// Download from Firestore
async function loadFromFirestore() {
  const docRef = db.collection("users").doc(userId).collection("workout").doc("data");
  const snap = await docRef.get();

  if (snap.exists) {
    data = snap.data();
    localBackup = data;  // sync local with cloud
    saveLocal();
  } else {
    data = {};
  }

  updateDayUI();
}

// Upload to Firestore
async function saveToFirestore() {
  if (!userId) return;

  const docRef = db.collection("users").doc(userId).collection("workout").doc("data");
  await docRef.set(data, { merge: true });

  localBackup = data;
  saveLocal();
}

// -------------------------
// 3. SAME WORKOUT RENDER LOGIC AS BEFORE
// -------------------------

const PLAN = {
  morning: [
    "Warm-up: 5 min jog",
    "Jumping Jacks: 3×40s",
    "Bodyweight Squats: 3×12–15",
    "Plank: 30–45s",
    "Calf Raises: 3×20",
    "Cool down"
  ],
  evening: [
    "Warm-up: 3–5 min",
    "Push-ups: 3×8–15",
    "Glute Bridge: 3×12–15",
    "Walking Lunges: 10–12/leg",
    "Leg Raises: 10–15",
    "Optional cardio",
    "Cool down"
  ]
};

const toISO = d => d.toISOString().slice(0, 10);
let currentDate = new Date();

function ensureDay(iso) {
  if (!data[iso]) {
    data[iso] = {
      morning: { exercises: PLAN.morning.map(() => false) },
      evening: { exercises: PLAN.evening.map(() => false) }
    };
  }
}

function getDayState(iso) {
  ensureDay(iso);
  return data[iso];
}

function renderExerciseList(listEl, planList, sessionName) {
  listEl.innerHTML = "";
  const iso = toISO(currentDate);
  ensureDay(iso);
  const state = data[iso][sessionName];

  planList.forEach((txt, idx) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <label class="checkbox">
        <input type="checkbox" data-session="${sessionName}" data-idx="${idx}" ${state.exercises[idx] ? "checked" : ""}>
        <span>${txt}</span>
      </label>
    `;
    listEl.appendChild(li);
  });

  listEl.querySelectorAll("input[type=checkbox]").forEach(cb => {
    cb.addEventListener("change", e => {
      const sess = e.target.dataset.session;
      const i = Number(e.target.dataset.idx);
      data[iso][sess].exercises[i] = e.target.checked;

      saveToFirestore();
      updateDayUI();
    });
  });
}

// Session toggle
function sessionCompleted(s) {
  return s.exercises.every(Boolean);
}

// Daily UI update
function updateDayUI() {
  const iso = toISO(currentDate);

  document.getElementById("dateDisplay").textContent =
    currentDate.toDateString();
  document.getElementById("dayTitle").textContent =
    "Workout for " + currentDate.toDateString();

  renderExerciseList(morningList, PLAN.morning, "morning");
  renderExerciseList(eveningList, PLAN.evening, "evening");

  const s = getDayState(iso);
  const mDone = s.morning.exercises.filter(Boolean).length;
  const eDone = s.evening.exercises.filter(Boolean).length;

  document.getElementById("morningStatus").textContent = `${mDone}/${PLAN.morning.length}`;
  document.getElementById("eveningStatus").textContent = `${eDone}/${PLAN.evening.length}`;

  const mComplete = sessionCompleted(s.morning);
  const eComplete = sessionCompleted(s.evening);

  toggleMorning.textContent = mComplete ? "Morning Completed ✓" : "Mark Morning Complete";
  toggleMorning.className = "large-btn " + (mComplete ? "complete" : "incomplete");

  toggleEvening.textContent = eComplete ? "Evening Completed ✓" : "Mark Evening Complete";
  toggleEvening.className = "large-btn " + (eComplete ? "complete" : "incomplete");

  const total = PLAN.morning.length + PLAN.evening.length;
  const done = mDone + eDone;
  const pct = Math.round(done / total * 100);

  document.getElementById("dailyProgressBar").style.width = pct + "%";
  document.getElementById("dailyPercent").textContent = pct + "%";
  document.getElementById("daySummary").textContent =
    `${done} of ${total} exercises completed`;

  renderMonth();
  renderOverall();
}

toggleMorning.addEventListener("click", () => {
  const iso = toISO(currentDate);
  ensureDay(iso);
  const st = data[iso].morning;
  const all = sessionCompleted(st);
  st.exercises = st.exercises.map(() => !all);
  saveToFirestore();
  updateDayUI();
});

toggleEvening.addEventListener("click", () => {
  const iso = toISO(currentDate);
  ensureDay(iso);
  const st = data[iso].evening;
  const all = sessionCompleted(st);
  st.exercises = st.exercises.map(() => !all);
  saveToFirestore();
  updateDayUI();
});

// Navigation
document.getElementById("prevBtn").onclick = () => {
  currentDate.setDate(currentDate.getDate() - 1);
  updateDayUI();
};
document.getElementById("nextBtn").onclick = () => {
  currentDate.setDate(currentDate.getDate() + 1);
  updateDayUI();
};
document.getElementById("todayBtn").onclick = () => {
  currentDate = new Date();
  updateDayUI();
};

// Month grid
function renderMonth() {
  const grid = document.getElementById("monthGrid");
  grid.innerHTML = "";

  for (let i = 29; i >= 0; i--) {
    const d = new Date(currentDate);
    d.setDate(d.getDate() - i);
    const iso = toISO(d);
    let done = 0, total = PLAN.morning.length + PLAN.evening.length;

    if (data[iso]) {
      let s = data[iso];
      done = s.morning.exercises.filter(Boolean).length + s.evening.exercises.filter(Boolean).length;
    }

    const pct = Math.round(done / total * 100);
    const col = document.createElement("div");
    col.className = "day-col";
    col.innerHTML = `
      <div style="height:104px;display:flex;align-items:flex-end;">
        <div class="bar" style="height:${pct}%"></div>
      </div>
      <div class="day-label">${d.getDate()}</div>
    `;
    col.onclick = () => {
      currentDate = d;
      updateDayUI();
    };
    grid.appendChild(col);
  }
}

// Overall
function renderOverall() {
  let done = 0, total = 0;

  Object.keys(data).forEach(iso => {
    let s = data[iso];
    done += s.morning.exercises.filter(Boolean).length +
            s.evening.exercises.filter(Boolean).length;
    total += PLAN.morning.length + PLAN.evening.length;
  });

  const pct = total === 0 ? 0 : Math.round(done / total * 100);
  document.getElementById("overallBar").style.width = pct + "%";
  document.getElementById("overallPercent").textContent = pct + "%";
  document.getElementById("overallSummary").textContent =
    `${done} of ${total} exercises`;
}

// Export / Import
document.getElementById("exportBtn").onclick = () => {
  document.getElementById("exportArea").value = JSON.stringify(data, null, 2);
};

document.getElementById("importBtn").onclick = async () => {
  try {
    data = JSON.parse(document.getElementById("exportArea").value);
    await saveToFirestore();
    updateDayUI();
    alert("Import successful");
  } catch (e) {
    alert("Invalid JSON");
  }
};

// Clear All
document.getElementById("clearAll").onclick = async () => {
  if (!confirm("Delete ALL workout data from the cloud?")) return;
  data = {};
  await saveToFirestore();
  updateDayUI();
};

</script>

</body>
</html>


